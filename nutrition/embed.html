<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Nutrition Shop (Embed)</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>html,body{margin:0;height:100%;overflow:hidden}</style>
</head>
<body>
  <a-scene renderer="antialias:true;physicallyCorrectLights:true" xr-mode-ui="enabled: true">
    <a-entity light="type:ambient;intensity:0.7"></a-entity>
    <a-entity light="type:directional;intensity:0.6" position="1 1 0"></a-entity>
    <a-plane position="0 0 -1" rotation="-90 0 0" width="20" height="20" color="#F5F5F5"></a-plane>
    <a-sky color="#eef2ff"></a-sky>

    <a-entity position="0 1.8 -2"><a-text value="Nutrition Shop" color="#f59e0b" align="center" width="4"></a-text></a-entity>

    <a-box id="start" position="-0.8 1.2 -2" depth="0.1" height="0.4" width="1.2" color="#f59e0b"></a-box>
    <a-text value="เริ่ม / Start" position="-1.2 1.22 -1.95" color="#fff" width="3"></a-text>

    <a-box id="finish" position="0.8 1.2 -2" depth="0.1" height="0.4" width="1.2" color="#f97316"></a-box>
    <a-text value="จบ / Finish" position="0.45 1.22 -1.95" color="#fff" width="3"></a-text>

    <a-entity position="0 0.7 -2"><a-text value="แตะเพื่อเลือกอาหารที่ดี (เดโม)" align="center" color="#111827" width="4"></a-text></a-entity>

    <a-sphere id="ball" position="0 1.2 -3" radius="0.25" color="#60a5fa" visible="false"></a-sphere>

    <a-entity position="0 1.6 0"><a-camera wasd-controls-enabled="true"></a-camera></a-entity>
  </a-scene>
  <script>
    const start = document.querySelector('#start');
    const finish = document.querySelector('#finish');
    const ball = document.querySelector('#ball');
    let score = 0; let t = 0; let timerStart = null; let loop=null;
    function post(type, extra={}){ try{ parent.postMessage(Object.assign({type},extra),'*'); }catch(e){} }
    start.addEventListener('click', ()=>{ ball.setAttribute('visible', true); score=0; t=0; timerStart=performance.now(); post('NUT_READY'); loop=setInterval(()=>{ t+=0.1; const x=Math.sin(t)*0.8; ball.setAttribute('position', x+' 1.2 -3'); }, 50); });
    ball.addEventListener('click', ()=>{ score+=10; ball.setAttribute('color', score%20===0?'#34d399':'#60a5fa'); });
    finish.addEventListener('click', ()=>{ const seconds = timerStart? Math.round((performance.now()-timerStart)/1000):0; clearInterval(loop); post('NUT_COMPLETE', { score, seconds }); alert('จบเกมแล้ว! ใช้เวลา '+seconds+' วินาที คะแนน '+score); });
  </script>
</body>
</html>